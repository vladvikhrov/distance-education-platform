{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
  {% if user.role == 'S' %}
    <!-- Режим просмотра для учеников -->
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <!-- Заголовок -->
        <div class="mb-4">
          <h2 class="fw-bold text-primary mb-2">{{ lesson.topic }}</h2>
          <p class="text-muted">
            <i class="bi bi-calendar3 me-2"></i>{{ lesson.data|date:"d.m.Y" }}
          </p>
        </div>

        <!-- Предметы -->
        {% if subjects %}
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body">
            <h6 class="text-secondary mb-3">
              <i class="bi bi-book me-2"></i>Предметы
            </h6>
            <div class="d-flex flex-wrap gap-2">
              {% for subject in subjects %}
                <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill fs-6 fw-normal">
                  {{ subject.name }}
                </span>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Дополнительные материалы -->
        {% if lesson.additionals or lesson.document %}
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body">
            <h6 class="text-secondary mb-3">
              <i class="bi bi-paperclip me-2"></i>Дополнительные материалы
            </h6>
            {% if lesson.additionals %}
              <div class="mb-3">{{ lesson.additionals|linebreaks }}</div>
            {% endif %}
            {% if lesson.document %}
              <a href="{{ lesson.document.url }}" target="_blank" 
                 class="btn btn-primary btn-sm">
                <i class="bi bi-download me-2"></i>Скачать файл
              </a>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- Домашнее задание -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body">
            <h6 class="text-secondary mb-3">
              <i class="bi bi-pencil-square me-2"></i>Домашнее задание
            </h6>
            <div class="text-dark">{{ lesson.home_work|linebreaks }}</div>
          </div>
        </div>

        <!-- Email учителя -->
        {% if lesson.email %}
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="text-secondary mb-3">
              <i class="bi bi-envelope me-2"></i>Контакт учителя
            </h6>
            <a href="mailto:{{ lesson.email }}" class="text-primary text-decoration-none">
              {{ lesson.email }}
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

  {% else %}
    <!-- Режим редактирования для учителей -->
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="mb-4">
          <h2 class="fw-bold text-primary">Редактирование урока</h2>
        </div>

        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          
          <!-- Дата урока -->
          <div class="card border-primary border-opacity-25 mb-3">
            <div class="card-body">
              <label class="form-label text-primary fw-semibold">
                <i class="bi bi-calendar3 me-2"></i>Дата урока
              </label>
              <input type="date" class="form-control form-control-lg" 
                     name="data" value="{{ lesson.data|date:'Y-m-d' }}">
            </div>
          </div>

          <!-- Тема урока -->
          <div class="card border-primary border-opacity-25 mb-3">
            <div class="card-body">
              <label class="form-label text-primary fw-semibold">
                <i class="bi bi-bookmark me-2"></i>Тема урока
              </label>
              <textarea class="form-control form-control-lg" 
                        name="topic" rows="2">{{ lesson.topic }}</textarea>
            </div>
          </div>

          <!-- Дополнительные материалы -->
          <div class="card border-primary border-opacity-25 mb-3">
            <div class="card-body">
              <label class="form-label text-primary fw-semibold">
                <i class="bi bi-paperclip me-2"></i>Дополнительные материалы
              </label>
              <textarea class="form-control" 
                        name="additionals" rows="3">{{ lesson.additionals }}</textarea>
            </div>
          </div>

          <!-- Домашнее задание -->
          <div class="card border-primary border-opacity-25 mb-3">
            <div class="card-body">
              <label class="form-label text-primary fw-semibold">
                <i class="bi bi-pencil-square me-2"></i>Домашнее задание
              </label>
              <textarea class="form-control" 
                        name="home_work" rows="4">{{ lesson.home_work }}</textarea>
            </div>
          </div>

          <!-- Email -->
          <div class="card border-primary border-opacity-25 mb-3">
            <div class="card-body">
              <label class="form-label text-primary fw-semibold">
                <i class="bi bi-envelope me-2"></i>Email для связи
              </label>
              <input type="email" class="form-control form-control-lg" 
                     name="email" value="{{ lesson.email }}">
            </div>
          </div>

          <!-- Файл -->
          <div class="card border-primary border-opacity-25 mb-4">
            <div class="card-body">
              <label class="form-label text-primary fw-semibold">
                <i class="bi bi-file-earmark-arrow-up me-2"></i>Файл урока
              </label>
              <input type="file" class="form-control" name="document">
              {% if lesson.document %}
                <div class="mt-3 p-3 bg-light rounded">
                  <a href="{{ lesson.document.url }}" target="_blank" 
                     class="text-primary text-decoration-none d-block mb-2">
                    <i class="bi bi-file-earmark-text me-2"></i>Текущий файл
                  </a>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="remove_file" 
                           value="remove" id="removeFile">
                    <label class="form-check-label text-danger" for="removeFile">
                      Удалить файл
                    </label>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Кнопка сохранения -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="bi bi-check-circle me-2"></i>Сохранить изменения
            </button>
          </form>
        </form>
      </div>
    </div>
  {% endif %}
</div>
{% endblock content %}